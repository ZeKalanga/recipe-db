name: ðŸ”„ Update Recipe-DB Submodule

on:
  push:
    branches: [main]

jobs:
  update-server:
    runs-on: ubuntu-latest
    steps:
      - name: SSH into Server and Update Recipe-DB Submodule
        env:
          SSH_PRIVATE_KEY: ${{ secrets.DEPLOY_SSH_KEY }}
        run: |
          set -euo pipefail
          mkdir -p ~/.ssh
          echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh -o StrictHostKeyChecking=no ubuntu@18.199.163.68 << 'EOF'
            set -euo pipefail
            cd /var/www/recipe-api

            echo "ï¿½ Updating recipe-db submodule to latest..."
            cd data
            git fetch origin main
            git reset --hard origin/main
            cd ..

            echo "â™»ï¸ Restarting related PM2 processes..."
            pm2 restart recipe-api || true
            pm2 restart recipe-ui || true
            pm2 save
            
            echo "âœ… Recipe-DB submodule updated successfully."
          EOF
